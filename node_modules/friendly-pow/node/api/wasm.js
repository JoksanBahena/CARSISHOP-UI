"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getWasmSolver = void 0;
const loader_1 = require("../loader");
async function getWasmSolver(module) {
    const w = await loader_1.instantiateWasmSolver(module);
    const arrPtr = w.exports.__retain(w.exports.__allocArray(w.exports.Uint8Array_ID, new Uint8Array(128)));
    let solution = w.exports.__getUint8Array(arrPtr);
    return (puzzleBuffer, threshold, n = 4294967295) => {
        solution.set(puzzleBuffer);
        const hashPtr = w.exports.solveBlake2b(arrPtr, threshold, n);
        solution = w.exports.__getUint8Array(arrPtr);
        const hash = w.exports.__getUint8Array(hashPtr);
        w.exports.__release(hashPtr);
        return [solution, hash];
    };
}
exports.getWasmSolver = getWasmSolver;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2FzbS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hcGkvd2FzbS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxzQ0FBa0Q7QUFFM0MsS0FBSyxVQUFVLGFBQWEsQ0FBQyxNQUFXO0lBQzdDLE1BQU0sQ0FBQyxHQUFHLE1BQU0sOEJBQXFCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFOUMsTUFBTSxNQUFNLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQy9CLENBQUMsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLElBQUksVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQ3JFLENBQUM7SUFDRixJQUFJLFFBQVEsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUVqRCxPQUFPLENBQUMsWUFBd0IsRUFBRSxTQUFpQixFQUFFLENBQUMsR0FBRyxVQUFVLEVBQUUsRUFBRTtRQUNwRSxRQUF1QixDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUMzQyxNQUFNLE9BQU8sR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzdELFFBQVEsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM3QyxNQUFNLElBQUksR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNoRCxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM3QixPQUFPLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzFCLENBQUMsQ0FBQztBQUNKLENBQUM7QUFoQkQsc0NBZ0JDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaW5zdGFudGlhdGVXYXNtU29sdmVyIH0gZnJvbSBcIi4uL2xvYWRlclwiO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0V2FzbVNvbHZlcihtb2R1bGU6IGFueSkge1xuICBjb25zdCB3ID0gYXdhaXQgaW5zdGFudGlhdGVXYXNtU29sdmVyKG1vZHVsZSk7XG5cbiAgY29uc3QgYXJyUHRyID0gdy5leHBvcnRzLl9fcmV0YWluKFxuICAgIHcuZXhwb3J0cy5fX2FsbG9jQXJyYXkody5leHBvcnRzLlVpbnQ4QXJyYXlfSUQsIG5ldyBVaW50OEFycmF5KDEyOCkpXG4gICk7XG4gIGxldCBzb2x1dGlvbiA9IHcuZXhwb3J0cy5fX2dldFVpbnQ4QXJyYXkoYXJyUHRyKTtcblxuICByZXR1cm4gKHB1enpsZUJ1ZmZlcjogVWludDhBcnJheSwgdGhyZXNob2xkOiBudW1iZXIsIG4gPSA0Mjk0OTY3Mjk1KSA9PiB7XG4gICAgKHNvbHV0aW9uIGFzIFVpbnQ4QXJyYXkpLnNldChwdXp6bGVCdWZmZXIpO1xuICAgIGNvbnN0IGhhc2hQdHIgPSB3LmV4cG9ydHMuc29sdmVCbGFrZTJiKGFyclB0ciwgdGhyZXNob2xkLCBuKTtcbiAgICBzb2x1dGlvbiA9IHcuZXhwb3J0cy5fX2dldFVpbnQ4QXJyYXkoYXJyUHRyKTtcbiAgICBjb25zdCBoYXNoID0gdy5leHBvcnRzLl9fZ2V0VWludDhBcnJheShoYXNoUHRyKTtcbiAgICB3LmV4cG9ydHMuX19yZWxlYXNlKGhhc2hQdHIpO1xuICAgIHJldHVybiBbc29sdXRpb24sIGhhc2hdO1xuICB9O1xufVxuIl19